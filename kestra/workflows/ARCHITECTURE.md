# Sistema de GestÃ£o de ClÃ­nicas - Fluxo Automatizado

## VisÃ£o Geral

Este sistema implementa uma **jornada 100% automatizada** para pacientes, eliminando a necessidade de recepÃ§Ã£o humana. A Ãºnica intervenÃ§Ã£o humana necessÃ¡ria Ã© o **mÃ©dico realizando a consulta**.

---

## Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PACIENTE                                       â”‚
â”‚                         (WhatsApp)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EVOLUTION API                                       â”‚
â”‚                   (WhatsApp Gateway)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         KESTRA                                           â”‚
â”‚                    (Orquestrador)                                        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Roteador    â”‚ â”‚ Agendamento â”‚ â”‚ Check-in    â”‚ â”‚ ConfirmaÃ§Ã£o â”‚        â”‚
â”‚  â”‚ WhatsApp    â”‚ â”‚ WhatsApp    â”‚ â”‚ AutomÃ¡tico  â”‚ â”‚ Consulta    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Processar   â”‚ â”‚ Transcrever â”‚ â”‚ Gerar       â”‚ â”‚ Pesquisa    â”‚        â”‚
â”‚  â”‚ Exame       â”‚ â”‚ Ãudio       â”‚ â”‚ SOAP        â”‚ â”‚ NPS         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FASTAPI BACKEND                                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Auth        â”‚ â”‚ Pacientes   â”‚ â”‚ Agenda      â”‚ â”‚ Cards       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ Kanban      â”‚ â”‚ EvidÃªncias  â”‚ â”‚ WhatsApp    â”‚                        â”‚
â”‚  â”‚ (NOVO)      â”‚ â”‚             â”‚ â”‚ Sessions    â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE                                          â”‚
â”‚            (PostgreSQL + Auth + Storage + RLS)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Jornada do Paciente (100% Automatizada)

```
PACIENTE                           SISTEMA                            MÃ‰DICO
    â”‚                                  â”‚                                  â”‚
    â”‚ "Oi, quero agendar"              â”‚                                  â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: agendamento-whatsapp                    â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  Bot: "Escolha especialidade: 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£"                    â”‚   â”‚
    â”‚   â”‚  Paciente: "2"                                              â”‚   â”‚
    â”‚   â”‚  Bot: "MÃ©dicos: 1ï¸âƒ£ Dr. JoÃ£o 2ï¸âƒ£ Dra. Maria"                 â”‚   â”‚
    â”‚   â”‚  Paciente: "1"                                              â”‚   â”‚
    â”‚   â”‚  Bot: "Datas: 1ï¸âƒ£ Seg 20/01 2ï¸âƒ£ Ter 21/01"                   â”‚   â”‚
    â”‚   â”‚  Paciente: "1"                                              â”‚   â”‚
    â”‚   â”‚  Bot: "HorÃ¡rios: 1ï¸âƒ£ 14:00 2ï¸âƒ£ 15:00"                        â”‚   â”‚
    â”‚   â”‚  Paciente: "2"                                              â”‚   â”‚
    â”‚   â”‚  Bot: "Confirma? SIM/NÃƒO"                                   â”‚   â”‚
    â”‚   â”‚  Paciente: "SIM"                                            â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Cria agendamento                                         â”‚   â”‚
    â”‚   â”‚  â†’ Cria card no Kanban (Fase 0)                             â”‚   â”‚
    â”‚   â”‚  â†’ Marca checklist: âœ… confirmado                           â”‚   â”‚
    â”‚   â”‚  â†’ Move para Fase 1 (automÃ¡tico)                            â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "âœ… Agendado! Seg 20/01 15:00"   â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚            (D-3)                 â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: anamnese-pendente (CRON 10h)            â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Busca consultas D+3 sem anamnese                         â”‚   â”‚
    â”‚   â”‚  â†’ Gera token Ãºnico                                         â”‚   â”‚
    â”‚   â”‚  â†’ Envia link pelo WhatsApp                                 â”‚   â”‚
    â”‚   â”‚  â†’ Marca checklist: âœ… anamnese_enviada                     â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "Preencha a anamnese: [link]"    â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ [Paciente preenche no celular]   â”‚                                  â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚ â†’ Marca: âœ… anamnese_preenchida  â”‚
    â”‚                                  â”‚ â†’ Checklist fase 1 completo!     â”‚
    â”‚                                  â”‚ â†’ Move para Fase 2 (automÃ¡tico)  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚            (D-1)                 â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: lembrete-d1 (CRON 18h)                  â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Busca consultas de amanhÃ£                                â”‚   â”‚
    â”‚   â”‚  â†’ Envia lembrete                                           â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "Lembrete: consulta amanhÃ£ 15h"  â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚          (D-0, 14:55)            â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: checkin-automatico (CRON */1min)        â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Busca consultas 5-6 min a frente                         â”‚   â”‚
    â”‚   â”‚  â†’ Envia pedido de check-in                                 â”‚   â”‚
    â”‚   â”‚  â†’ Marca: âœ… checkin_enviado                                â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "VocÃª chegou? CHEGUEI/CAMINHO"   â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "CHEGUEI"                        â”‚                                  â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: processar-checkin                       â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Marca: âœ… checkin_confirmado                             â”‚   â”‚
    â”‚   â”‚  â†’ Move card para subfase "em_espera"                       â”‚   â”‚
    â”‚   â”‚  â†’ Notifica mÃ©dico: "Paciente chegou!"                      â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "âœ… Check-in confirmado!"        â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                                  â”‚    ğŸ”” "Maria chegou"              â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                    CONSULTA MÃ‰DICA (Ãºnica interaÃ§Ã£o humana)         â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                            [gravaâ”‚
    â”‚                                  â”‚                            Ã¡udio]â”‚
    â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: transcrever-audio                       â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Download do Ã¡udio                                        â”‚   â”‚
    â”‚   â”‚  â†’ Whisper API â†’ TranscriÃ§Ã£o                                â”‚   â”‚
    â”‚   â”‚  â†’ Salva no banco                                           â”‚   â”‚
    â”‚   â”‚  â†’ Dispara geraÃ§Ã£o de SOAP                                  â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: gerar-soap                              â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Busca transcriÃ§Ã£o + dados paciente + anamnese            â”‚   â”‚
    â”‚   â”‚  â†’ Claude API â†’ Gera SOAP estruturado                       â”‚   â”‚
    â”‚   â”‚  â†’ Sugere CIDs automaticamente                              â”‚   â”‚
    â”‚   â”‚  â†’ Marca: âœ… soap_gerado                                    â”‚   â”‚
    â”‚   â”‚  â†’ Move para Fase 3 (automÃ¡tico)                            â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                                  â”‚    ğŸ”” "SOAP pronto para revisÃ£o"  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                          [revisa â”‚
    â”‚                                  â”‚                           aprova]â”‚
    â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚ â†’ Marca: âœ… soap_aprovado        â”‚
    â”‚                                  â”‚ â†’ Checklist fase 3 completo!     â”‚
    â”‚                                  â”‚ â†’ Move para Fase 4 (FINALIZADO)  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚          (D-0, 19:00)            â”‚                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚           WORKFLOW: pesquisa-satisfacao (CRON 19h)          â”‚   â”‚
    â”‚   â”‚                                                             â”‚   â”‚
    â”‚   â”‚  â†’ Busca consultas finalizadas hoje                         â”‚   â”‚
    â”‚   â”‚  â†’ Envia pesquisa NPS                                       â”‚   â”‚
    â”‚   â”‚  â†’ Marca: âœ… nps_enviado                                    â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "Como foi? â­â­â­â­â­ [link]"      â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "Deseja agendar retorno?"        â”‚                                  â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚ "SIM"                            â”‚                                  â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                  â”‚
    â”‚                                  â”‚                                  â”‚
    â”‚                                  â”‚ â†’ Inicia novo fluxo de           â”‚
    â”‚                                  â”‚   agendamento (volta ao inÃ­cio)  â”‚
    â”‚                                  â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Kanban AutomÃ¡tico

### Fases e TransiÃ§Ãµes

```
FASE 0: AGENDADO
â”œâ”€â”€ Checklist:
â”‚   â”œâ”€â”€ âœ… confirmacao_enviada (auto)
â”‚   â””â”€â”€ âœ… confirmado (auto)
â”‚
â”œâ”€â”€ Quando TODOS âœ… â†’ Move para FASE 1
â”‚
FASE 1: PRÃ‰-CONSULTA
â”œâ”€â”€ Checklist:
â”‚   â”œâ”€â”€ âœ… anamnese_enviada (auto)
â”‚   â”œâ”€â”€ âœ… anamnese_preenchida (auto)
â”‚   â”œâ”€â”€ â—‹ exames_solicitados (opcional)
â”‚   â””â”€â”€ â—‹ exames_recebidos (opcional, auto)
â”‚
â”œâ”€â”€ Quando OBRIGATÃ“RIOS âœ… â†’ Move para FASE 2
â”‚
FASE 2: DIA DA CONSULTA
â”œâ”€â”€ Subfases: aguardando_checkin â†’ em_espera â†’ em_atendimento â†’ finalizado
â”œâ”€â”€ Checklist:
â”‚   â”œâ”€â”€ âœ… checkin_enviado (auto)
â”‚   â”œâ”€â”€ âœ… checkin_confirmado (auto)
â”‚   â”œâ”€â”€ âœ… consulta_iniciada (mÃ©dico)
â”‚   â””â”€â”€ âœ… consulta_finalizada (mÃ©dico)
â”‚
â”œâ”€â”€ Quando OBRIGATÃ“RIOS âœ… â†’ Move para FASE 3
â”‚
FASE 3: PÃ“S-CONSULTA
â”œâ”€â”€ Checklist:
â”‚   â”œâ”€â”€ âœ… soap_gerado (auto)
â”‚   â”œâ”€â”€ âœ… soap_aprovado (mÃ©dico)
â”‚   â”œâ”€â”€ â—‹ receita_emitida (opcional)
â”‚   â”œâ”€â”€ â—‹ atestado_emitido (opcional)
â”‚   â””â”€â”€ â—‹ nps_enviado (auto)
â”‚
â”œâ”€â”€ Quando OBRIGATÃ“RIOS âœ… â†’ Move para FASE 4
â”‚
FASE 4: FINALIZADO
â””â”€â”€ Card arquivado
```

### LÃ³gica de TransiÃ§Ã£o AutomÃ¡tica

```python
# Quando um item do checklist Ã© marcado como concluÃ­do:

1. Atualiza item no checklist
2. Verifica se TODOS os obrigatÃ³rios da fase estÃ£o âœ…
3. Se sim:
   a. Calcula prÃ³xima fase
   b. Cria checklist zerado da nova fase
   c. Move card
   d. Registra histÃ³rico
   e. Dispara eventos/notificaÃ§Ãµes
```

---

## Workflows Kestra

| # | Workflow | Trigger | FunÃ§Ã£o |
|---|----------|---------|--------|
| 00 | agendamento-whatsapp | Webhook | Fluxo conversacional de agendamento |
| 01 | confirmacao-consulta | Webhook | Envia confirmaÃ§Ã£o apÃ³s agendar |
| 02 | lembrete-d1 | Cron 18h | Lembrete dia anterior |
| 03 | processar-mensagem | Webhook | Processa SIM/NÃƒO/CANCELAR |
| 04 | transcrever-audio | Webhook | Whisper transcriÃ§Ã£o |
| 05 | gerar-soap | Webhook | Claude gera SOAP |
| 06 | processar-doc-financeiro | Webhook | OCR + Claude extrai dados |
| 07 | conciliar-extrato | Webhook | Match automÃ¡tico |
| 08 | alertas-vencimento | Cron 8h | Alertas financeiros |
| 09 | processar-exame | Webhook | OCR + vincula exame |
| 10 | anamnese-pendente | Cron 10h | Envia link D-3 |
| 11 | pesquisa-satisfacao | Cron 19h | NPS pÃ³s-consulta |
| 12 | marcar-falta | Cron */1h | Auto-marca faltas |
| 13 | checkin-automatico | Cron */1min | Envia pedido check-in |
| 14 | roteador-whatsapp | Webhook | Roteia mensagens |

---

## Endpoints do Backend

### Novos endpoints necessÃ¡rios:

```
# SessÃµes WhatsApp
POST   /v1/internal/whatsapp/sessao              # Cria/busca sessÃ£o
GET    /v1/internal/whatsapp/sessao/ativa        # Busca sessÃ£o ativa
PATCH  /v1/internal/whatsapp/sessao/{id}         # Atualiza estado

# Agendamentos
GET    /v1/internal/agendamentos/aguardando-checkin
GET    /v1/internal/agendamentos/pendente-confirmacao
GET    /v1/internal/agenda/datas-disponiveis
GET    /v1/internal/agenda/slots

# Kanban
GET    /v1/kanban                                # Lista cards por fase
GET    /v1/kanban/cards/{id}                     # Detalhe do card
POST   /v1/kanban/cards                          # Cria card
POST   /v1/kanban/cards/{id}/checklist/{key}     # Atualiza checklist
POST   /v1/kanban/cards/{id}/mover               # Move manualmente
PATCH  /v1/kanban/cards/{id}/subfase             # Muda subfase
```

---

## Resumo: IntervenÃ§Ã£o Humana

| Quem | O que faz | Quando |
|------|-----------|--------|
| **PACIENTE** | Responde WhatsApp | Agendamento, check-in |
| **MÃ‰DICO** | Consulta, SOAP, Receita | Durante atendimento |
| **SISTEMA** | TODO O RESTO | 24/7 automÃ¡tico |

### Eliminados:
- âŒ Recepcionista
- âŒ Atendente de telefone
- âŒ Pessoa movendo Kanban
- âŒ Pessoa fazendo check-in
- âŒ Pessoa confirmando consultas
- âŒ Pessoa enviando lembretes
